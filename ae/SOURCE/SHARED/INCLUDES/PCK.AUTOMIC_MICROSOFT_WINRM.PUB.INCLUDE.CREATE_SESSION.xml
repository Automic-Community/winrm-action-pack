<?xml version="1.0" encoding="ISO-8859-15" standalone="no"?><uc-export clientvers="11.0.0">
<JOBI name="PCK.AUTOMIC_MICROSOFT_WINRM.PUB.INCLUDE.CREATE_SESSION">
<HEADER state="1">
<Title>Create Session</Title>
<ArchiveKey1/>
<ArchiveKey2/>
<OH_SubType/>
</HEADER>
<SCRIPT mode="1" state="1">
<MSCRI><![CDATA[


:SET &UC4RB_WRM_CRED_CMDLET# = "$credential = New-Object System.Management.Automation.PSCredential( "

!    Domain
:    IF &UC4RB_WRM_DOMAIN# NE ""
:      INC PCK.AUTOMIC_MICROSOFT_WINRM.PUB.INCLUDE.ESCAPE_ARG_VALUE "&TEMP_OPTION_VALUE#" = "&UC4RB_WRM_DOMAIN#"
:      SET &UC4RB_WRM_CRED_CMDLET# = STR_CAT(&UC4RB_WRM_CRED_CMDLET#, '"&UC4RB_WRM_ESC_VALUE#\')
:    ENDIF

!    Username
:    INC PCK.AUTOMIC_MICROSOFT_WINRM.PUB.INCLUDE.ESCAPE_ARG_VALUE "&TEMP_OPTION_VALUE#" = "&UC4RB_WRM_USERNAME#"
:    SET &UC4RB_WRM_CRED_CMDLET# = STR_CAT(&UC4RB_WRM_CRED_CMDLET#, '&UC4RB_WRM_ESC_VALUE#", $secPwd)')


! --- Create a PSCredential Object containing the username and password ---
:    SET &UC4RB_WRM_SESSION_CMDLET# = "$session = New-PSSession"
:    SET &UC4RB_WRM_PSO_CMDLET# = "$sessionOption = New-PSSessionOption"
:    SET &FLAG# = 0
!    Buidling Connect command
!    Host name
:    INC PCK.AUTOMIC_MICROSOFT_WINRM.PUB.INCLUDE.ESCAPE_ARG_VALUE "&TEMP_OPTION_VALUE#" = "&UC4RB_WRM_HOST#"
:    SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, ' -ComputerName "&UC4RB_WRM_ESC_VALUE#"')

!    Port
:    SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, ' -Port "&UC4RB_WRM_PORT#"')

!    Credential
:    SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, " -Credential $credential")

!    Use SSL
:    IF &UC4RB_WRM_SSL# EQ "YES"
:        SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, " -UseSSL")
:    ENDIF


!    Enable Multi-Hop (CredSSP)
:    IF &UC4RB_WRM_MULTI_HOP# EQ "YES"
:      SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, " -Authentication CredSSP")
:    ENDIF

!    Skip CA Check
:    IF &UC4RB_WRM_CA_CHECK# EQ "YES"
:      SET &UC4RB_WRM_PSO_CMDLET# = STR_CAT(&UC4RB_WRM_PSO_CMDLET#, " -SkipCACheck")
:      SET &FLAG# = 1
:    ENDIF

!    Skip CN Check
:    IF &UC4RB_WRM_CN_CHECK# EQ "YES"
:      SET &UC4RB_WRM_PSO_CMDLET# = STR_CAT(&UC4RB_WRM_PSO_CMDLET#, " -SkipCNCheck")
:      SET &FLAG# = 1
:    ENDIF

!    Skip Revocation Check
!:    IF &UC4RB_WRM_REVOC_CHECK# NE ""
!:      SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, " -SkipRevocationCheck")
!:    ENDIF

:    IF &FLAG# EQ 1
:      SET &UC4RB_WRM_SESSION_CMDLET# = STR_CAT(&UC4RB_WRM_SESSION_CMDLET#, " -SessionOption $sessionOption")
:    ENDIF
!
!:    print "CREDENTIAL COMMANDLET :&UC4RB_WRM_CRED_CMDLET#"
!:    print "PS SESSION OPTIONS COMMANDLET :&UC4RB_WRM_PSO_CMDLET#"
!:    print "CONNECTION COMMANDLET: &UC4RB_WRM_SESSION_CMDLET#"


! Initialize the error
$errors = 0
! Load powershell utility
: INC PCK.ITPA_SHARED.PUB.INCLUDE.POWERSHELL_UTILITY


!   Set the parameter to stop in order to terminate the script execution on error
$ErrorActionPreference= 'Stop'
!   To ignore DisplayDeprecationWarnings
$WarningPreference= 'SilentlyContinue'

! --- Create a PSCredential Object containing the username and password ---
!    DECRYPT PASSWORD
:   INC PCK.ITPA_SHARED.PUB.INCLUDE.ATTACH
:   SET &UC4RB_ENCRYPTED_PASSWORD_TMP# = &UC4RB_WRM_PASSWORD#
:   INC PCK.ITPA_SHARED.PRV.INCLUDE.DECRYPT_PASSWORD
! Securing password
$secPwd = ConvertTo-SecureString "$UC4_DECRYPTED_PWD" -AsPlainText -Force
! Genearting credential using username and password
:    SET &UC4RB_LOGGING_INFO# =  "CREDENTIAL COMMANDLET: &UC4RB_WRM_CRED_CMDLET#"
:    INC PCK.ITPA_SHARED.PRV.INCLUDE.LOGGING.INFO
&UC4RB_WRM_CRED_CMDLET#

!    Session advance option commandlet
:    SET &UC4RB_LOGGING_INFO# =  "CREDENTIAL COMMANDLET: &UC4RB_WRM_PSO_CMDLET#"
:    INC PCK.ITPA_SHARED.PRV.INCLUDE.LOGGING.INFO

]]></MSCRI>
</SCRIPT>
<DOCU_Docu state="1" type="text">
<DOC><![CDATA[Create a session with the remote host using WinRM. ]]></DOC>
</DOCU_Docu>
</JOBI>
</uc-export>